<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>CS Tapper</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #20273a 0, #050811 55%, #020308 100%);
      color: #f5f5f5;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .app {
      width: 100%;
      max-width: 420px;
      padding: 16px;
      text-align: center;
    }
    .card {
      background: rgba(10, 14, 30, 0.9);
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 0 18px rgba(0, 0, 0, 0.7);
      border: 1px solid rgba(80, 120, 255, 0.45);
    }
    .title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .subtitle {
      font-size: 13px;
      color: #9ba3c0;
      margin-bottom: 14px;
    }
    .stats {
      display: flex;
      justify-content: space-between;
      margin-bottom: 12px;
      font-size: 14px;
    }
    .stat-label {
      color: #9ba3c0;
      font-size: 12px;
    }
    .stat-value {
      font-weight: 600;
      font-size: 16px;
    }
    .energy-bar {
      position: relative;
      width: 100%;
      height: 12px;
      border-radius: 999px;
      background: rgba(30, 40, 80, 0.8);
      overflow: hidden;
      margin-bottom: 16px;
    }
    .energy-fill {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 50%;
      background: linear-gradient(90deg, #23d5ab, #23a6d5, #4a7dff);
      transition: width 0.15s ease-out;
    }
    .energy-text {
      font-size: 12px;
      color: #b3bcdb;
      margin-bottom: 10px;
    }
    .agent-wrap {
      margin: 10px 0 6px;
    }
    .agent-btn {
      width: 220px;
      height: 220px;
      border-radius: 999px;
      border: 3px solid rgba(90, 140, 255, 0.8);
      background: radial-gradient(circle at 30% 0%, #3d7bff 0, #111727 55%, #050711 100%);
      box-shadow: 0 0 32px rgba(40, 120, 255, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: transform 0.08s ease-out, box-shadow 0.08s ease-out;
      margin: 0 auto;
    }
    .agent-btn.disabled {
      filter: grayscale(0.4) brightness(0.7);
      box-shadow: 0 0 10px rgba(20, 20, 30, 0.8);
      cursor: default;
    }
    .agent-btn:active:not(.disabled) {
      transform: scale(0.96);
      box-shadow: 0 0 18px rgba(40, 120, 255, 0.8);
    }
    .agent-img {
      width: 80%;
      height: 80%;
      border-radius: 999px;
      background:
        radial-gradient(circle at 30% 20%, rgba(255, 255, 255, 0.22) 0, transparent 55%),
        url("https://via.placeholder.com/512x512.png?text=CS+SWAT") center/cover no-repeat;
    }
    .hint {
      font-size: 11px;
      color: #67708c;
      margin-top: 6px;
    }
    .pulse {
      position: absolute;
      inset: 0;
      border-radius: 999px;
      box-shadow: 0 0 26px rgba(0, 200, 255, 0.8);
      opacity: 0;
      pointer-events: none;
      animation: pulse 0.4s ease-out;
    }
    @keyframes pulse {
      0% { opacity: 0.8; transform: scale(1); }
      100% { opacity: 0; transform: scale(1.25); }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="card">
      <div class="title">CS Tapper</div>
      <div class="subtitle">Тапай по спецназу, копи очки</div>

      <div class="stats">
        <div>
          <div class="stat-label">Счёт</div>
          <div class="stat-value" id="score">0</div>
        </div>
        <div>
          <div class="stat-label">Лучший</div>
          <div class="stat-value" id="bestScore">0</div>
        </div>
      </div>

      <div class="energy-bar">
        <div class="energy-fill" id="energyFill"></div>
      </div>
      <div class="energy-text" id="energyText">Энергия: 0 / 0</div>

      <div class="agent-wrap">
        <div class="agent-btn" id="agentBtn">
          <div class="agent-img"></div>
        </div>
        <div class="hint">Энергия тратится при каждом тапе и постепенно восстанавливается.</div>
      </div>
    </div>
  </div>

  <script>
    const MAX_ENERGY = 20;
    const REGEN_INTERVAL_MS = 1000; // +1 энергии в секунду
    const STORAGE_KEY = "cs_tapper_state_v1";

    const scoreEl = document.getElementById("score");
    const bestScoreEl = document.getElementById("bestScore");
    const energyTextEl = document.getElementById("energyText");
    const energyFillEl = document.getElementById("energyFill");
    const agentBtn = document.getElementById("agentBtn");

    let state = {
      score: 0,
      bestScore: 0,
      energy: MAX_ENERGY,
      lastUpdate: Date.now()
    };

    function loadState() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return;
        const saved = JSON.parse(raw);
        if (typeof saved.score === "number") state.score = saved.score;
        if (typeof saved.bestScore === "number") state.bestScore = saved.bestScore;
        if (typeof saved.energy === "number") state.energy = saved.energy;
        if (typeof saved.lastUpdate === "number") state.lastUpdate = saved.lastUpdate;
      } catch (e) {
        console.warn("Failed to load state", e);
      }
    }

    function saveState() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      } catch (e) {
        console.warn("Failed to save state", e);
      }
    }

    function syncEnergyByTime() {
      const now = Date.now();
      const diffSec = Math.floor((now - state.lastUpdate) / 1000);
      if (diffSec > 0 && state.energy < MAX_ENERGY) {
        state.energy = Math.min(MAX_ENERGY, state.energy + diffSec);
        state.lastUpdate = now;
      } else {
        state.lastUpdate = now;
      }
    }

    function updateUI() {
      scoreEl.textContent = state.score;
      bestScoreEl.textContent = state.bestScore;
      energyTextEl.textContent = `Энергия: ${state.energy} / ${MAX_ENERGY}`;
      const ratio = Math.max(0, Math.min(1, state.energy / MAX_ENERGY));
      energyFillEl.style.width = (ratio * 100).toFixed(1) + "%";

      if (state.energy <= 0) {
        agentBtn.classList.add("disabled");
      } else {
        agentBtn.classList.remove("disabled");
      }
    }

    function tap() {
      if (state.energy <= 0) return;

      state.score += 1;
      state.energy -= 1;
      if (state.score > state.bestScore) {
        state.bestScore = state.score;
      }
      state.lastUpdate = Date.now();
      saveState();
      animatePulse();
      updateUI();
    }

    function animatePulse() {
      const pulse = document.createElement("div");
      pulse.className = "pulse";
      agentBtn.appendChild(pulse);
      setTimeout(() => pulse.remove(), 400);
    }

    function regenLoop() {
      syncEnergyByTime();
      updateUI();
    }

    agentBtn.addEventListener("click", tap);

    loadState();
    syncEnergyByTime();
    updateUI();
    setInterval(regenLoop, REGEN_INTERVAL_MS);
  </script>
</body>
</html>
